	

<% @crops_loop = @crops_from_crops_table.sort_by{|c| c.crop } %>
<% @crops_loop.each_with_index{ |c,i| %>
	
	<div style="border: solid 1px black;padding:22px;">
		<% @in_pipeline = SeedFlat.where(harvest_weight_oz: nil).where(crop_id: c) %>
		<h3><strong><%= c.crop %></strong>, <%= c.crop_variety %> -- <%= @in_pipeline.count %> flats in pipeline</h3>
		<% @in_pipeline.group_by{|flat| flat.current_system_id }.each{|key,val| %>
			
				<%= System.where(id: key)[0].system_name %><br>
				<% val.sort_by{|flat| (Date.today - flat.started_date).to_i }.each{|flat| %>
					<% if flat.customer_id == nil or Customer.where(id: flat.customer_id)[0].name == "overgrow" %>
						<div>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= link_to "#{flat.flat_id}: #{(Date.today - flat.started_date).to_i} day", flat %>
						</div>
					<% else %>
						<div>
						<strong>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= link_to "#{flat.flat_id}: #{(Date.today - flat.started_date).to_i} day, for #{Customer.where(id: flat.customer_id)[0].name}", flat %>
						</strong>
						</div>
					<% end %>
			
			<% } %>
		<% } %>
		<% next if @crops_loop[i+1] == nil %>
		<div id=<%= @crops_loop[i+1].crop.gsub(" ","-") %>><br><br><br><br><br><br></div>
	</div>
<% } %>

<br><br>
<hr>
<br><br>